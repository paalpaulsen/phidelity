name: Deploy to SFTP (Debug)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  debug-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Install LFTP
        run: sudo apt-get install -y lftp

      - name: List Remote Files
        env:
          SFTP_PASS: ${{ secrets.SFTP_PASSWORD }}
        run: |
          # Create a debug script to list files and folders
          echo "set sftp:auto-confirm yes" > debug.lftp
          echo "set ssl:verify-certificate no" >> debug.lftp
          echo "open sftp://${{ secrets.SFTP_SERVER }}" >> debug.lftp
          echo "user ${{ secrets.SFTP_USERNAME }} \"$SFTP_PASS\"" >> debug.lftp
          
          # List root directory to see structure
          echo "echo 'listing / ...'" >> debug.lftp
          echo "ls -l /" >> debug.lftp
          
          # List current directory (home)
          echo "echo 'listing . ...'" >> debug.lftp
          echo "ls -l" >> debug.lftp
          
          echo "bye" >> debug.lftp
          
          # Run lftp
          lftp -f debug.lftp
